import{D as e,r as t,c as a,o as s,t as i,u as l,a as o,b as d,d as n,e as u,f as r,g as c,w as p,h as y,i as m,j as g,_ as h,k as v,l as w,F as f,m as x,T as k,n as b,p as _,q,s as D,v as E,x as C,y as P,z as A,A as B,S as I,B as L,C as Q,E as O,G as U,H as j,I as R,J as S,K as T,L as F,M,N,O as $,P as H,Q as V,R as J,U as X,V as Y,W as G,X as K,Y as Z,Z as z,$ as W,a0 as ee,a1 as te,a2 as ae,a3 as se,a4 as ie,a5 as le,a6 as oe,a7 as de,a8 as ne,a9 as ue,aa as re,ab as ce,ac as pe,ad as ye,ae as me,af as ge,ag as he}from"./vendor.d28893cf.js";import ve from"https://jspm.dev/better-podcast-parser";import we from"https://jspm.dev/better-podcast-parser@0.1.16";function fe(e){return(new DOMParser).parseFromString(e,"text/html").body.textContent}function xe(e,t=125){return e.length>t?e.substr(0,t)+"...":e}function ke(e=0){return new Date(1e3*e).toISOString().substr(11,8)}function be(){return["iPad","iPhone","iPod","iPad Simulator","iPhone Simulator","iPod Simulator"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}function _e(e,t){return Math.floor(e/t*100)}function qe(t){let a=e.fromObject({seconds:t}).shiftTo("hours","minutes","seconds").toObject(),s="";return a.hours>0&&(s+=a.hours+" hr"),a.minutes>0&&(s+=" "+a.minutes+" min"),a.seconds>0&&(s+=" "+a.seconds+" sec"),s}const De={setup(e){const o=t(0),d=setInterval((()=>{o.value<=3?o.value+=1:o.value=0}),150),n=a((()=>{let e=new Array;for(let t=0;t<o.value;t++)e.push(".");return e.join("")}));return s((()=>{clearInterval(d)})),(e,t)=>i(l(n))}},Ee={key:0},Ce={key:0,class:"h-48 bg-gray-200"},Pe={class:"p-3 h-full flex flex-col justify-between sm:justify-around"},Ae={class:"flex justify-between"},Be={class:"flex flex-col w-4/5"},Ie={class:"w-full text-gray-800 text-sm"},Le={class:"w-full whitespace-no-wrap overflow-x-hidden"},Qe={class:"hidden md:block"},Oe={class:"flex justify-end items-start w-1/5"},Ue={class:"flex flex-col justify-between h-full sm:flex-row sm:items-center"},je={class:"flex justify-between items-center sm:w-2/5 lg:w-1/4"},Re={class:"sm:flex-1 sm:ml-8"},Se={class:"flex items-center justify-between"},Te={class:"relative w-full"},Fe=["max","value"],Me={key:1,class:"h-36 bg-gray-200 flex justify-center items-center"},Ne=y(" Loading player"),$e={setup(e){const s=o(),g=t(!0),h=a((()=>s.state.playingEpisode)),v=a((()=>ke(h.value.duration))),w=a((()=>ke(h.value.playhead))),f=a((()=>s.state.paused)),x=()=>{s.dispatch("playOrPause")},k=()=>{s.dispatch("jumpAhead")},b=()=>{s.dispatch("jumpBack")},_=()=>{s.dispatch("playNext")},q=()=>{s.dispatch("playPrev")},D=e=>{s.dispatch("setPlayhead",e.target.value)};return(e,t)=>{var a,s,o,E;const C=d("marquee"),P=d("font-awesome-icon");return l(h)?(n(),u("div",Ee,[g.value?(n(),u("div",Ce,[r("div",Pe,[r("div",Ae,[r("div",Be,[r("div",Ie,i(null==(o=null==(s=null==(a=l(h))?void 0:a.podcast)?void 0:s.meta)?void 0:o.title),1),r("div",Le,[c(C,{class:"md:hidden",scrollamount:"4"},{default:p((()=>{var e;return[y(i(null==(e=l(h))?void 0:e.title),1)]})),_:1}),r("div",Qe,i(null==(E=l(h))?void 0:E.title),1)])]),r("div",Oe,[c(P,{icon:"chevron-down",class:"text-4xl",onClick:t[0]||(t[0]=e=>g.value=!1)})])]),r("div",Ue,[r("div",je,[c(P,{icon:"step-backward",class:"text-4xl",onClick:q}),c(P,{icon:"undo",class:"text-4xl",onClick:b}),r("div",{class:"text-5xl text-teal-500 flex justify-center items-center",onClick:x},[l(f)?(n(),m(P,{key:0,icon:"play"})):(n(),m(P,{key:1,icon:"pause"}))]),c(P,{icon:"redo",class:"text-4xl",onClick:k}),c(P,{icon:"step-forward",class:"text-4xl",onClick:_})]),r("div",Re,[r("div",null,i(l(w))+" / "+i(l(v)),1),r("div",null,[r("div",Se,[r("div",Te,[r("input",{id:"play-slider",class:"w-full appearance-none bg-gray-200",type:"range",min:"0",max:l(h).duration,value:l(h).playhead,onChange:D},null,40,Fe)])])])])])])])):(n(),u("div",{key:1,class:"h-12 bg-gray-200 flex items-center justify-center",onClick:t[1]||(t[1]=e=>g.value=!0)},[c(P,{icon:"chevron-up",class:"text-4xl"})]))])):(n(),u("div",Me,[Ne,c(De)]))}}};let He={dexieDB:null,playingAudio:null,wakeLock:null,downloadedEpisodeFiles:null,downloadedImageFiles:null},Ve=g({state:()=>({queue:[],playingEpisode:null,paused:!0,downloading:[],downloaded:[],queueChanging:!1}),getters:{currentlyPlayingInQueue:e=>e.queue.filter((e=>1==e.currently_playing))[0],getEpisodeInQueue:e=>t=>e.queue.filter((e=>e._id==t))[0],isInQueue:e=>t=>e.queue.map((e=>e._id)).includes(t),queueInOrder:e=>h.sortBy(e.queue,["queue"]),isPlaying:e=>t=>{var a;return(null==(a=e.playingEpisode)?void 0:a._id)==t&&!e.paused}},mutations:{addEpisodeToQueue(e,t){e.queue.push(t)},clearQueue(e){e.queue=[]},removeEpisodeFromQueue(e,t){let a=h.findIndex(e.queue,(e=>e._id==t));e.queue.splice(a,1)},setQueueOfEpisode(e,t){let a=h.findIndex(e.queue,(e=>e._id==t.episodeID));e.queue[a].queue=t.newQueue},setPlayingEpisode(e,t){delete t.queue,e.playingEpisode=t},updatePlayhead(e,t){e.playingEpisode.playhead=t},setPlayheadOfEpisode(e,t){let a=h.findIndex(e.queue,(e=>e._id==t.episodeID));e.queue[a].playhead=t.newPlayhead},clearCurrentlyPlaying(e){for(let t=0;t<e.queue.length;t++)e.queue[t].currently_playing=0},setCurrentlyPlaying(e,t){let a=h.findIndex(e.queue,(e=>e._id==t));e.queue[a].currently_playing=1},addEpisodeToDownloading(e,t){e.downloading.push({id:t,progress:0})},setEpisodeDownloadingProgress(e,t){let a=h.findIndex(e.downloading,(e=>e.id==t.id));e.downloading[a].progress=t.progress},removeEpisodeFromDownloading(e,t){let a=h.findIndex(e.downloading,(e=>e.id==t));e.downloading.splice(a,1)},addEpisodeToDownloaded(e,t){e.downloaded.push(t)},setQueueChanging(e,t){e.queueChanging=t}},actions:{getQueue:e=>(e.commit("clearQueue"),He.dexieDB.episodes.where("queue").above(0).toArray().then((e=>e.map((async e=>(e.podcast=await He.dexieDB.podcasts.where({_id:e.podcast_id}).first(),e))))).then((e=>Promise.all(e))).then((t=>{let a=h.sortBy(t,["queue"]);for(let s of a)e.commit("addEpisodeToQueue",s)}))),removeEpisodeFromQueue(e,t){e.commit("setQueueChanging",!0);let a=e.state.queue.filter((e=>t==e._id))[0];return He.dexieDB.episodes.where({_id:t}).modify({queue:0}).then((()=>(e.commit("removeEpisodeFromQueue",t),He.dexieDB.episodes.where("queue").above(a.queue).toArray()))).then((t=>{let a=[];if(t.length>0){for(let s of t)s.queue-=1,a.push(He.dexieDB.episodes.where({_id:s._id}).modify({queue:s.queue}).then((()=>{e.commit("setQueueOfEpisode",{episodeID:s._id,newQueue:s.queue})})));return Promise.all(a).then((()=>{e.commit("setQueueChanging",!1)}))}return Promise.resolve().then((()=>{e.commit("setQueueChanging",!1)}))}))},async addEpisodeToQueue(e,t){e.commit("setQueueChanging",!0);let a=await He.dexieDB.episodes.where("queue").above(0).toArray(),s=(a.length>0?Math.max(...a.map((e=>e.queue))):0)+1;await He.dexieDB.episodes.where({_id:t}).modify({queue:s});let i=await He.dexieDB.episodes.where({_id:t}).first();i.podcast=await He.dexieDB.podcasts.where({_id:i.podcast_id}).first(),e.commit("addEpisodeToQueue",i),e.commit("setQueueChanging",!1)},async playEpisode(e,t){let a=!He.playingAudio.paused,s=t.hasOwnProperty("id")?t.id:null,i=!!t.hasOwnProperty("startPlaying")&&t.startPlaying;He.playingAudio&&!He.playingAudio.paused&&He.playingAudio.pause(),await He.dexieDB.episodes.filter((e=>1==e.currently_playing)).modify({currently_playing:0}),e.commit("clearCurrentlyPlaying"),e.getters.isInQueue(s)||await e.dispatch("addEpisodeToQueue",s);let l=await He.dexieDB.episodes.where({_id:s}).first(),o=await He.dexieDB.podcasts.where({_id:l.podcast_id}).first();l.podcast=o,e.commit("setPlayingEpisode",l),await He.dexieDB.episodes.where({_id:s}).modify({currently_playing:1}),e.commit("clearCurrentlyPlaying"),e.commit("setCurrentlyPlaying",s);let d=await He.downloadedEpisodeFiles.getItem("podrain_episode_"+s);if(d){let e=await d.arrayBuffer(),t=new Blob([e],{type:l.enclosure.type});He.playingAudio.src=URL.createObjectURL(t)}else He.playingAudio.src=e.state.playingEpisode.enclosure.url;He.playingAudio.currentTime=e.state.playingEpisode.playhead,He.playingAudio.addEventListener("timeupdate",(t=>{e.commit("updatePlayhead",He.playingAudio.currentTime),e.commit("setPlayheadOfEpisode",{episodeID:e.state.playingEpisode._id,newPlayhead:He.playingAudio.currentTime})})),He.playingAudio.load(),(a||i)&&He.playingAudio.play()},playOrPause(e){He.playingAudio.paused?He.playingAudio.play():He.playingAudio.pause()},jumpAhead(){He.playingAudio.currentTime+=15},jumpBack(){He.playingAudio.currentTime-=15},setPlayhead(e,t){He.playingAudio.currentTime=t,e.commit("updatePlayhead",He.playingAudio.currentTime)},async playNext(e,t={}){let a=!!t.hasOwnProperty("finishEpisode")&&t.finishEpisode,s=!!t.hasOwnProperty("startPlaying")&&t.startPlaying,i=h.clone(e.state.playingEpisode._id),l=h.sortBy(e.state.queue,["queue"])[0],o=h.reverse(h.sortBy(e.state.queue,["queue"]))[0];if(e.getters.currentlyPlayingInQueue.queue==o.queue)await e.dispatch("playEpisode",{id:l._id,startPlaying:s});else{let t=e.state.queue.filter((t=>t.queue==e.getters.currentlyPlayingInQueue.queue+1))[0];await e.dispatch("playEpisode",{id:t._id,startPlaying:s})}a&&(e.commit("setQueueChanging",!0),await e.dispatch("removeEpisodeFromQueue",i),e.commit("setQueueChanging",!1),await He.dexieDB.episodes.where({_id:i}).modify({playhead:0,played:v.now().setZone("utc").toISO()}),e.dispatch("removeDownload",i))},playPrev(e){if(1==e.getters.currentlyPlayingInQueue.queue){let t=h.reverse(h.sortBy(e.state.queue,["queue"]))[0];e.dispatch("playEpisode",{id:t._id})}else{let t=e.state.queue.filter((t=>t.queue==e.getters.currentlyPlayingInQueue.queue-1))[0];e.dispatch("playEpisode",{id:t._id})}},reorderQueue(e,t){e.commit("setQueueChanging",!0);let a=t.hasOwnProperty("episodeID")?t.episodeID:null,s=t.hasOwnProperty("newOrder")?t.newOrder:null,i=e.state.queue.filter((e=>e._id==a))[0],l=[];if(s<i.queue){let t=e.state.queue.filter((e=>e.queue>=s&&e.queue<i.queue));for(let a of t)l.push(He.dexieDB.episodes.where({_id:a._id}).modify({queue:a.queue+1}).then((()=>{e.commit("setQueueOfEpisode",{episodeID:a._id,newQueue:a.queue+1})})))}else if(s>i.queue){let t=e.state.queue.filter((e=>e.queue<=s&&e.queue>i.queue));for(let a of t)l.push(He.dexieDB.episodes.where({_id:a._id}).modify({queue:a.queue-1}).then((()=>{e.commit("setQueueOfEpisode",{episodeID:a._id,newQueue:a.queue-1})})))}return Promise.all([He.dexieDB.episodes.where({_id:a}).modify({queue:s}).then((()=>{e.commit("setQueueOfEpisode",{episodeID:a,newQueue:s})})),...l]).then((()=>e.commit("setQueueChanging",!1)))},async downloadEpisode(e,t){e.commit("addEpisodeToDownloading",t);let a=localStorage.getItem("proxy_url")||"",s=await w.get(a+e.getters.getEpisodeInQueue(t).enclosure.url,{onDownloadProgress(a){e.commit("setEpisodeDownloadingProgress",{id:t,progress:Math.floor(a.loaded/a.total*100)})},headers:{Accept:"audio/*"},responseType:"arraybuffer"}),i=s.headers["content-type"],l=new Blob([s.data],{type:i});await He.downloadedEpisodeFiles.setItem("podrain_episode_"+t,l),e.dispatch("syncDownloadedEpisodes"),e.commit("removeEpisodeFromDownloading",t)},async removeDownload(e,t){await He.downloadedEpisodeFiles.getItem("podrain_episode_"+t)&&(await He.downloadedEpisodeFiles.removeItem("podrain_episode_"+t),e.dispatch("syncDownloadedEpisodes"))},async syncDownloadedEpisodes(e){let t=(await He.downloadedEpisodeFiles.keys()).filter((e=>e.includes("podrain_episode_"))).map((e=>e.substr("podrain_episode_".length)));e.state.downloaded=t},playOrPauseEpisode(e,t){var a;t==(null==(a=e.state.playingEpisode)?void 0:a._id)?e.state.paused?He.playingAudio.play():He.playingAudio.pause():e.dispatch("playEpisode",{id:t,startPlaying:!0})}}});const Je={class:"flex flex-col h-screen"},Xe={class:"flex justify-center bg-teal-700"},Ye={class:"flex text-white h-16 w-full sm:w-2/3 md:w-1/2 lg:w-2/5 xl:w-1/3"},Ge={class:"h-full flex justify-center items-center"},Ke={class:"flex-1 flex justify-center overflow-y-scroll bg-gray-800"},Ze={setup(e){const t=[{link:"/home",icon:"home"},{link:"/podcasts",icon:"music"},{link:"/queue",icon:"list-ol"},{link:"/history",icon:"history"},{link:"/podcasts/create",icon:"plus"},{link:"/settings",icon:"cog"}],a=o();return a.dispatch("syncDownloadedEpisodes"),He.playingAudio=new Audio,He.playingAudio.addEventListener("pause",(e=>{a.state.paused=!0})),He.playingAudio.addEventListener("play",(e=>{a.state.paused=!1})),He.playingAudio.addEventListener("ended",(e=>{a.dispatch("playNext",{finishEpisode:!0,startPlaying:!0})})),He.playingAudio.addEventListener("loadedmetadata",(()=>{a.state.playingEpisode.duration=He.playingAudio.duration})),a.dispatch("getQueue").then((()=>a.state.queue.length>0?He.dexieDB.episodes.where({currently_playing:1}).toArray().then((e=>{a.dispatch("playEpisode",{id:e[0]._id})})):Promise.resolve())).then((()=>{setInterval((()=>{He.dexieDB.episodes.where({_id:a.state.playingEpisode._id}).modify({playhead:a.state.playingEpisode.playhead}).then((()=>{a.commit("setPlayheadOfEpisode",{episodeID:a.state.playingEpisode._id,newPlayhead:a.state.playingEpisode.playhead})}))}),5e3)})),(e,a)=>{const s=d("font-awesome-icon"),i=d("router-link"),l=d("router-view");return n(),u("div",Je,[r("div",Xe,[r("div",Ye,[(n(),u(f,null,x(t,(e=>c(i,{key:e.link,to:e.link,class:"flex-1","active-class":"bg-teal-800"},{default:p((()=>[r("div",Ge,[c(s,{class:"text-4xl",icon:e.icon},null,8,["icon"])])])),_:2},1032,["to"]))),64))])]),r("div",Ke,[c(l,null,{default:p((({Component:e})=>[c(k,{name:"fade",mode:"out-in"},{default:p((()=>[(n(),m(b(e)))])),_:2},1024)])),_:1})]),c($e)])}}};const ze=["alt"],We={props:{id:String,backupURL:"",alt:String},setup(e){const a=e,s=t(null),i=[{from:"green-500",to:"blue-500"},{from:"pink-400",to:"red-600"},{from:"yellow-500",to:"orange-500"}][(o=3,Math.floor(Math.random()*o))];var o;const d=e=>{e.target.style.padding="0"};return _((async()=>{let e=await He.downloadedImageFiles.getItem("podrain_image_"+a.id);if(e){let t=e.type,a=await e.arrayBuffer(),i=new Blob([a],{type:t});s.value.src=URL.createObjectURL(i)}else s.value.src=a.backupURL})),(t,a)=>(n(),u("img",{ref:s,alt:e.alt,class:q(["text-white text-center text-lg flex justify-center items-center bg-gradient-to-br p-4",`from-${l(i).from} to-${l(i).to}`]),onLoad:d},null,42,ze))}},et={key:0,class:"\n        grid \n        grid-cols-3 \n        sm:grid-cols-4 \n        md:grid-cols-6 \n        lg:grid-cols-8\n        xl:grid-cols-10\n        2xl:grid-cols-12\n        auto-rows-max\n      "},tt={key:1,class:"text-white h-full flex-1 flex justify-center items-center"},at={class:"flex flex-col"},st=y(" There are no podcasts. "),it={setup(e){const a=D(),s=t([]);return He.dexieDB.podcasts.toArray().then((e=>{s.value=e})),(e,t)=>s.value.length>0?(n(),u("div",et,[(n(!0),u(f,null,x(s.value,(e=>(n(),m(We,{id:e._id,alt:e.meta.title,backupURL:e.meta.imageURL,key:e._id,onClick:t=>l(a).push(`/podcasts/${e._id}`)},null,8,["id","alt","backupURL","onClick"])))),128))])):(n(),u("div",tt,[r("div",at,[st,r("button",{onClick:t[0]||(t[0]=e=>l(a).push("/podcasts/create")),class:"mt-2 p-2 bg-green-500"},"Add some!")])]))}},lt={class:"responsive-width"},ot={class:"flex flex-col"},dt={class:"flex"},nt={class:"w-1/3 m-3"},ut={class:"w-2/3 flex flex-col justify-center text-lg py-3 pr-3"},rt={class:"text-white font-bold leading-snug"},ct={class:"mt-3 flex-col"},pt={class:"flex"},yt=y(" Refresh "),mt=y(" Delete "),gt=y(" Search episodes "),ht={class:"mx-3 mb-3"},vt=["onClick"],wt={key:0,class:"w-8 h-8 bg-yellow-500 absolute bottom-0 left-0 flex justify-center items-center"},ft={class:"text-white leading-tight text-xs font-bold truncate"},xt={class:"flex mt-3"},kt={class:"w-1/5"},bt=["src"],_t={class:"w-4/5 text-xs font-light ml-3 text-gray-300"},qt={class:"italic"},Dt={class:"mt-2 font-bold"},Et={class:"flex"},Ct=["onClick"],Pt={class:"flex-1"},At={key:0,class:"bg-gray-500 text-white text-center p-1"},Bt=["onClick"],It=["onClick"],Lt={class:"p-3"},Qt={class:"text-white text-xl"},Ot={class:"flex mt-3"},Ut=["innerHTML"],jt={setup(e){const s=o(),g=D(),w=E(),k=t({meta:{title:"",imageURL:""}}),b=t([]),_=t([]),q=t(!1),A=t(!1),B=t(!1),I=t({}),L=a((()=>s.state.queue)),Q=a((()=>s.state.queueChanging));He.dexieDB.podcasts.where({_id:w.params.id}).toArray().then((e=>(k.value=e[0],O())));const O=()=>He.dexieDB.episodes.where({podcast_id:k.value._id}).reverse().sortBy("pubDate").then((e=>{b.value=e,_.value=b.value.slice(0,10)})),U=()=>{const e=b.value.slice(_.value.length,_.value.length+10);_.value=_.value.concat(e)},j=async()=>{A.value=!0,await function(e){let t=Promise.resolve();for(let a of e)a.podcast_id==k.value._id&&(t=t.then((()=>s.dispatch("removeEpisodeFromQueue",a._id))));return t}(s.state.queue);let e=He.dexieDB.podcasts.where({_id:k.value._id}).delete(),t=He.dexieDB.episodes.where({podcast_id:k.value._id}).delete();await Promise.all([e,t]),A.value=!1,g.push("/podcasts")},R=e=>{if(e){return xe(fe(e))}return"No description available."},S=async()=>{q.value=!0;let e=(await ve.parseURL(k.value.feed_url,{proxyURL:localStorage.getItem("proxy_url"),getAllPages:!0})).episodes.filter((e=>e&&e.hasOwnProperty("pubDate")&&e.pubDate>h.max(_.value.map((e=>e.pubDate))))).map((e=>h.merge(e,{_id:P(),podcast_id:k.value._id,queue:0,playhead:0,currently_playing:0,played:""})));await He.dexieDB.episodes.bulkAdd(e),await O(),q.value=!1},T=()=>{B.value=!1,I.value=""};return(e,t)=>{const a=d("font-awesome-icon"),o=d("o-modal");return n(),u("div",lt,[r("div",ot,[r("div",dt,[r("div",nt,[k.value._id?(n(),m(We,{key:0,id:k.value._id,backupURL:k.value.meta.imageURL},null,8,["id","backupURL"])):C("",!0)]),r("div",ut,[r("h1",rt,i(k.value.meta.title),1),r("div",ct,[r("div",pt,[r("button",{class:"text-white bg-indigo-500 p-2 text-sm flex-1",onClick:S},[q.value?(n(),m(a,{key:0,class:"mr-1",icon:"sync",pulse:""})):(n(),m(a,{key:1,class:"mr-1",icon:"sync"})),yt]),r("button",{class:"text-white bg-red-500 p-2 text-sm flex-1",onClick:j},[A.value?(n(),m(a,{key:0,class:"mr-1",icon:"spinner",spin:""})):(n(),m(a,{key:1,class:"mr-1",icon:"times"})),mt])]),r("button",{class:"bg-yellow-500 p-2 text-sm w-full",onClick:t[0]||(t[0]=e=>l(g).push("/podcasts/"+k.value._id+"/search"))},[c(a,{class:"mr-1",icon:"search"}),gt])])])]),r("ul",ht,[(n(!0),u(f,null,x(_.value,(e=>{return n(),u("li",{class:"flex flex-col mt-3",key:e._id},[r("div",{class:"p-3 relative bg-gray-700",onClick:t=>{return a=e._id,B.value=!0,void(I.value=_.value.filter((e=>e._id==a))[0]);var a}},[e.played?(n(),u("div",wt,[c(a,{icon:"check"})])):C("",!0),r("div",ft,i(e.title),1),r("div",xt,[r("div",kt,[r("img",{src:e.imageURL||k.value.meta.imageURL},null,8,bt)]),r("div",_t,[r("span",qt,i((o=e.pubDate,v.fromISO(o).toFormat("D"))),1),y(" —  "+i(R(e.description))+" ",1),r("div",Dt,[c(a,{icon:"clock"}),y(" "+i(l(qe)(e.duration)),1)])])])],8,vt),r("div",Et,[r("button",{class:"w-1/5 bg-blue-500",onClick:t=>{return a=e._id,void s.dispatch("playOrPauseEpisode",a);var a}},[(t=e._id,s.getters.isPlaying(t)?(n(),m(a,{key:0,class:"text-white",icon:"pause"})):(n(),m(a,{key:1,class:"text-white",icon:"play"})))],8,Ct),r("div",Pt,[l(Q)?(n(),u("div",At," queue changing ")):(n(),u(f,{key:1},[l(L).map((e=>e._id)).includes(e._id)?(n(),u("button",{key:0,class:"w-full bg-red-500 text-white p-1",onClick:t=>(e=>s.dispatch("removeEpisodeFromQueue",e))(e._id)},"Remove from queue",8,Bt)):(n(),u("button",{key:1,class:"w-full bg-green-500 text-white p-1",onClick:t=>(e=>s.dispatch("addEpisodeToQueue",e))(e._id)},"Add to queue",8,It))],64))])])]);var t,o})),128))]),r("button",{class:"bg-purple-500 text-white mx-3 mb-3 p-3",onClick:U}," Show More ")]),c(o,{active:B.value,onCancel:T,contentClass:"bg-gray-700 text-white p-3",mobileClass:"px-3",scroll:"clip"},{default:p((()=>[r("div",Lt,[r("h1",Qt,i(I.value.title),1),r("div",Ot,[r("div",{class:"prose-sm prose-episode-details",innerHTML:I.value.description},null,8,Ut)])])])),_:1},8,["active"])])}}},Rt={class:"responsive-width"},St={class:"p-3 text-white"},Tt=r("h1",{class:"text-xl text-center"},"Settings",-1),Ft={class:"mt-6"},Mt=y(" Download Backup Of Podcasts "),Nt=r("h2",{class:"text-white mt-3"},"Restore backup Of Podcasts",-1),$t=["disabled"],Ht=y(" Restore backup "),Vt=["disabled"],Jt=y("Downloading images "),Xt=y("Download images for podcasts "),Yt={setup(e){t(localStorage.getItem("proxy_url")||"");const a=t(""),s=t(!1),o=t(null),p=t(!!He.wakeLock),g=t(!1),h=e=>{o.value=e.target.files[0]},v=()=>{s.value=!0,a.value="Starting restore...",o.value.text().then((e=>{let t=JSON.parse(e);return a.value="Clearing podcasts...",Promise.all([He.dexieDB.podcasts.clear(),He.dexieDB.episodes.clear()]).then((()=>(a.value="Loading new podcasts...",Promise.all([He.dexieDB.podcasts.bulkAdd(t.podcasts),He.dexieDB.episodes.bulkAdd(t.episodes)])))).then((()=>{s.value=!1,a.value="Podcasts loaded!"}))}))},x=()=>{let e=He.dexieDB.podcasts.toArray(),t=He.dexieDB.episodes.toArray();Promise.all([e,t]).then((e=>{let t={podcasts:e[0],episodes:e[1]},a=new Blob([JSON.stringify(t)],{type:"text/plain;charset=utf8"});B.saveAs(a,"backup.json")}))},k=async()=>{g.value=!0;let e=await He.dexieDB.podcasts.toArray();for(let t of e){console.log("downloading "+t._id);let e=await w.get(localStorage.getItem("proxy_url")+t.meta.imageURL,{headers:{Accept:"image/*"},responseType:"arraybuffer"}),a=e.headers["content-type"],s=new Blob([e.data],{type:a});He.downloadedImageFiles.setItem("podrain_image_"+t._id,s)}g.value=!1};return A(p,(e=>{"wakeLock"in navigator?(e&&!He.wakeLock&&navigator.wakeLock.request("screen").then((e=>{He.wakeLock=e})),!e&&He.wakeLock&&He.wakeLock.release().then((()=>{He.wakeLock=null}))):alert("Cannot keep this device awake. 'Keep awake' setting is ignored.")})),(e,t)=>{const p=d("font-awesome-icon");return n(),u("div",Rt,[r("div",St,[Tt,r("div",Ft,[r("button",{class:"bg-purple-600 p-1 text-white mr-1 w-full",onClick:x},[c(p,{icon:"download",class:"mr-1"}),Mt])]),Nt,r("input",{type:"file",class:"text-white mt-1",onChange:h},null,32),o.value?(n(),u("button",{key:0,class:"bg-orange-600 p-1 text-white mr-1 w-full mt-3",disabled:s.value,onClick:v},[s.value?(n(),u(f,{key:0},[s.value?(n(),m(p,{key:0,icon:"spinner",spin:""})):C("",!0),y(" "+i(a.value),1)],64)):(n(),u(f,{key:1},[c(p,{icon:"upload",class:"mr-1"}),Ht],64))],8,$t)):C("",!0),l(be)()?C("",!0):(n(),u("button",{key:1,class:"bg-blue-500 p-3 mt-3",onClick:k,disabled:g.value},[g.value?(n(),u(f,{key:0},[c(p,{icon:"spinner",spin:"",class:"mr-1"}),Jt],64)):(n(),u(f,{key:1},[c(p,{icon:"image",class:"mr-1"}),Xt],64))],8,Vt))])])}}};const Gt={class:"responsive-width"},Kt={id:"queue-list",class:"p-3"},Zt=["data-id"],zt=["onClick"],Wt={key:0,class:"w-8 h-8 bg-yellow-500 absolute bottom-0 left-0 flex justify-center items-center"},ea={class:"flex mt-3"},ta={class:"w-1/5"},aa=["src"],sa={class:"italic"},ia={class:"mt-2 font-bold"},la=["disabled"],oa={class:"flex"},da=["onClick"],na=["onClick"],ua=y(" Remove from queue "),ra=["onClick","disabled"],ca={class:"flex h-full justify-center items-center relative text-white"},pa={setup(e){const t=o(),s=D(),p=a((()=>t.getters.queueInOrder));a((()=>t.state.downloading));const g=a((()=>t.state.queueChanging)),h=e=>t.state.downloading.map((e=>e.id)).includes(e),w=e=>t.state.downloading.filter((t=>t.id==e))[0].progress,k=e=>t.state.downloaded.includes(e),b=e=>{if(e){return xe(fe(e))}return"No description available."};return _((()=>{let e=document.getElementById("queue-list");I.create(e,{handle:".queue-dragbar",scroll:!0,animation:150,onUpdate(e){let a=e.newIndex+1,s=e.item.dataset.id;t.dispatch("reorderQueue",{episodeID:s,newOrder:a})}})})),(e,a)=>{const o=d("font-awesome-icon");return n(),u("div",Gt,[r("ul",Kt,[(n(!0),u(f,null,x(l(p),(e=>{return n(),u("li",{class:"episode-in-queue flex flex-col mt-3",key:e._id,"data-id":e._id},[r("div",{class:q(["flex",[e.currently_playing?"bg-orange-500":"bg-gray-700"]])},[r("div",{class:"p-3 relative w-full",onClick:t=>l(s).push("/episodes/"+e._id)},[r("div",{class:"absolute top-0 left-0 h-1 bg-teal-500",style:L(`width: ${l(_e)(e.playhead,e.duration)}%`)},null,4),e.played?(n(),u("div",Wt,[c(o,{icon:"check"})])):C("",!0),r("div",{class:q(["leading-tight text-xs font-bold",[e.currently_playing?"text-gray-900":"text-white"]])},i(e.title),3),r("div",ea,[r("div",ta,[r("img",{src:e.imageURL||e.podcast.meta.imageURL},null,8,aa)]),r("div",{class:q(["w-4/5 text-xs font-light ml-3",[e.currently_playing?"text-gray-900":"text-gray-300"]])},[r("span",sa,i((d=e.pubDate,v.fromISO(d).toFormat("D"))),1),y(" —  "+i(b(e.description))+" ",1),r("div",ia,[c(o,{icon:"clock"}),y(" "+i(l(qe)(e.duration)),1)])],2)])],8,zt),r("button",{class:"queue-dragbar bg-purple-500 w-10 text-white",disabled:l(g)},[l(g)?(n(),m(o,{key:0,icon:"spinner",spin:""})):(n(),m(o,{key:1,icon:"bars"}))],8,la)],2),r("div",oa,[r("button",{class:"bg-blue-500 text-white px-4",onClick:a=>{return s=e._id,void t.dispatch("playOrPauseEpisode",s);var s}},[(a=e._id,t.getters.isPlaying(a)?(n(),m(o,{key:0,icon:"pause"})):(n(),m(o,{key:1,icon:"play"})))],8,da),r("button",{class:"flex-1 bg-red-500 text-white p-1",onClick:a=>{return s=e._id,void t.dispatch("removeEpisodeFromQueue",s);var s}},[l(g)?(n(),m(o,{key:0,icon:"spinner",spin:""})):(n(),u(f,{key:1},[ua],64))],8,na),l(be)()?C("",!0):(n(),u("button",{key:0,class:q(["flex-1 relative",[h(e._id)?"bg-gray-600":"bg-blue-500"]]),onClick:a=>(e=>{k(e)?t.dispatch("removeDownload",e):t.dispatch("downloadEpisode",e)})(e._id),disabled:h(e._id)},[h(e._id)||k(e._id)?(n(),u("div",{key:0,class:"h-full bg-green-500 absolute",style:L(`width: ${k(e._id)?"100":w(e._id)}%`)},null,4)):C("",!0),r("div",ca,i(k(e._id)?"Downloaded":h(e._id)?w(e._id)>0?`${w(e._id)}%`:"Starting download...":"Download"),1)],10,ra))])],8,Zt);var a,d})),128))])])}}},ya={class:"responsive-width"},ma={class:"p-3"},ga={class:"text-white text-xl"},ha={class:"flex mt-3"},va=["innerHTML"],wa={setup(e){const a=t({}),s=E();return He.dexieDB.episodes.where({_id:s.params.id}).toArray().then((e=>{a.value=e[0]})),(e,t)=>(n(),u("div",ya,[r("div",ma,[r("h1",ga,i(a.value.title),1),r("div",ha,[r("div",{class:"prose-sm prose-episode-details",innerHTML:a.value.description},null,8,va)])])]))}},fa={class:"responsive-width"},xa={class:"p-3"},ka={class:"text-white"},ba=y("Search episodes in "),_a={class:"italic"},qa={class:"bg-gray-700 p-3"},Da={class:"text-xs text-gray-300"},Ea={class:"text-sm mt-2"},Ca=["onClick"],Pa=["onClick"],Aa={setup(e){const s=o(),p=E(),m=t({}),g=t(""),v=t([]),w=t([]),k=a((()=>s.state.queue)),b=He.dexieDB.podcasts.where({_id:p.params.id}).first().then((e=>{m.value=e})),_=He.dexieDB.episodes.where({podcast_id:p.params.id}).toArray().then((e=>{v.value=e}));Promise.all([b,_]);const q=e=>{if(e){return xe(fe(e),150)}return"No description available."};return A(g,h.debounce((function(e){w.value=v.value.filter((t=>{let a=t.description.toLowerCase(),s=t.title.toLowerCase();return a.includes(e.toLowerCase())||s.includes(e.toLowerCase())}))}),1e3)),(e,t)=>{var a,o;const p=d("font-awesome-icon");return n(),u("div",fa,[r("div",xa,[r("h1",ka,[ba,r("span",_a,i(null==(o=null==(a=m.value)?void 0:a.meta)?void 0:o.title),1)]),Q(r("input",{class:"p-1 w-full mt-1","onUpdate:modelValue":t[0]||(t[0]=e=>g.value=e)},null,512),[[O,g.value]]),r("ul",null,[(n(!0),u(f,null,x(w.value,(e=>(n(),u("li",{class:"text-white mt-3",key:e._id},[r("div",qa,[r("h2",null,i(e.title),1),r("p",Da,i(q(e.description)),1),r("div",Ea,[c(p,{icon:"clock"}),y(" "+i(l(qe)(e.duration)),1)])]),l(k).map((e=>e._id)).includes(e._id)?(n(),u("button",{key:0,class:"bg-red-500 w-full text-white p-1",onClick:t=>{return a=e._id,void s.dispatch("removeEpisodeFromQueue",a);var a}},"Remove from queue",8,Ca)):(n(),u("button",{key:1,class:"bg-green-500 w-full text-white p-1",onClick:t=>{return a=e._id,void s.dispatch("addEpisodeToQueue",a);var a}},"Add to queue",8,Pa))])))),128))])])])}}},Ba={class:"responsive-width"},Ia={class:"p-3"},La=r("div",{class:"text-white text-2xl"},"Add Podcast",-1),Qa={class:"flex mt-3"},Oa=y(" Search "),Ua=y(" RSS "),ja={key:0},Ra={key:0,class:"text-white text-center text-4xl mt-6"},Sa={else:"",class:"mt-3"},Ta=["src"],Fa={class:"w-4/5 p-2 bg-gray-700 flex-1"},Ma={key:0,class:"text-gray-200 text-sm"},Na={key:1,class:"text-gray-200 text-sm"},$a={key:0,class:"bg-green-500 w-10",disabled:""},Ha=["onClick","disabled"],Va={key:1},Ja=["disabled"],Xa=y("Adding podcast... "),Ya=y("Submit "),Ga={setup(e){const a=D(),s=t("search"),l=t(""),o=t(""),p=t([]),y=t(!1),m=t({url:"",adding:!1,episodesAdded:0,episodesTotal:0}),g=e=>{m.value.adding=!0,m.value.url=e;let t=e.replace(/(?!:\/\/):/g,"%3A");return we.parseURL(t,{proxyURL:localStorage.getItem("proxy_url"),getAllPages:!0}).then((e=>{let a=h.clone(e);delete a.episodes;let s=P();m.value.episodesTotal=e.episodes.length;let i=He.dexieDB.podcasts.add(h.merge(a,{_id:s,feed_url:t})).then((()=>be()?Promise.resolve():w.get(localStorage.getItem("proxy_url")+a.meta.imageURL,{headers:{Accept:"image/*"},responseType:"arraybuffer"}))).then((e=>{if(be())return Promise.resolve();let t=e.headers["content-type"],a=new Blob([e.data],{type:t});He.downloadedImageFiles.setItem("podrain_image_"+s,a)})),l=[];for(let t of e.episodes)l.push(He.dexieDB.episodes.add(h.merge(t,{_id:P(),podcast_id:s,queue:0,playhead:0,currently_playing:0,played:""})).then((()=>{m.value.episodesAdded+=1})));return Promise.all([i,...l]).then((()=>{m.value.url="",m.value.adding=!1,m.value.episodesAdded=0,m.value.episodesTotal=0}))}))},v=()=>{g(l.value).then((()=>{a.push("/podcasts")}))};return A(o,h.debounce((function(e){y.value=!0;let t="https://itunes.apple.com/search?"+new URLSearchParams({term:e,media:"podcast",entity:"podcast"});fetch(t).then((e=>e.json())).then((e=>{p.value=e.results,y.value=!1}))}),250)),(e,t)=>{const h=d("font-awesome-icon");return n(),u("div",Ba,[r("div",Ia,[La,r("div",Qa,[r("button",{class:q(["flex-1 p-3 text-white",["search"==s.value?"bg-orange-500":"bg-gray-900"]]),onClick:t[0]||(t[0]=e=>s.value="search")},[c(h,{icon:"search"}),Oa],2),r("button",{class:q(["flex-1 p-3 text-white",["rss"==s.value?"bg-orange-500":"bg-gray-900"]]),onClick:t[1]||(t[1]=e=>s.value="rss")},[c(h,{icon:"rss"}),Ua],2)]),"search"==s.value?(n(),u("div",ja,[Q(r("input",{type:"text",class:"w-full mt-3 p-1",placeholder:"Podcast title to search...","onUpdate:modelValue":t[2]||(t[2]=e=>o.value=e)},null,512),[[O,o.value]]),y.value?(n(),u("div",Ra,[c(h,{icon:"spinner",spin:""})])):C("",!0),r("ul",Sa,[(n(!0),u(f,null,x(p.value,(e=>(n(),u("li",{class:"text-white flex mt-3",key:e.collectionId},[r("img",{class:"w-1/5",src:e.artworkUrl100},null,8,Ta),r("div",Fa,[r("h3",null,i(e.collectionName),1),m.value.url==e.feedUrl?(n(),u("span",Ma,i(m.value.episodesAdded)+" / "+i(m.value.episodesTotal)+" episodes added",1)):(n(),u("span",Na,i(e.trackCount)+" episodes",1))]),m.value.url==e.feedUrl?(n(),u("button",$a,[c(h,{icon:"spinner",spin:""})])):(n(),u("button",{key:1,class:"bg-green-500 w-10",onClick:t=>{return s=e.feedUrl,void g(s).then((()=>{a.push("/podcasts")}));var s},disabled:""!=m.value.url&&m.value.url!=e.feedUrl},[c(h,{icon:"plus"})],8,Ha))])))),128))])])):C("",!0),"rss"==s.value?(n(),u("div",Va,[Q(r("input",{type:"text",class:"w-full mt-3 p-1",placeholder:"https://example.com/podcast/feed","onUpdate:modelValue":t[3]||(t[3]=e=>l.value=e)},null,512),[[O,l.value]]),r("button",{disabled:m.value.adding,class:"w-full bg-green-500 mt-3 p-2 text-white",onClick:v},[m.value.adding?(n(),u(f,{key:0},[c(h,{icon:"spinner",class:"mr-2",spin:""}),Xa],64)):(n(),u(f,{key:1},[c(h,{icon:"check",class:"mr-2"}),Ya],64))],8,Ja)])):C("",!0)])])}}},Ka={class:"responsive-width"},Za={class:"p-3"},za=r("h1",{class:"text-white text-xl text-center"},"Your episode history",-1),Wa={key:0,class:"flex justify-center mt-4"},es={key:1},ts={key:0},as=["onClick"],ss={class:"text-sm text-gray-400 italic mt-2"},is={class:"text-xs text-gray-300 mt-2"},ls={class:"text-sm mt-2"},os=["onClick"],ds=["onClick"],ns={key:1,class:"text-white italic mt-3"},us={setup(e){const s=t(!1),p=t([]),m=t(0),g=o(),h=D(),w=a((()=>g.state.queue));s.value=!0,He.dexieDB.episodes.where("played").notEqual("").count().then((e=>{m.value=e})),He.dexieDB.episodes.where("played").notEqual("").reverse().limit(10).sortBy("played").then((e=>{p.value=e,s.value=!1}));const k=e=>{if(e){return xe(fe(e),150)}return"No description available."},b=()=>{He.dexieDB.episodes.where("played").notEqual("").reverse().offset(p.value.length).limit(10).sortBy("played").then((e=>{p.value=p.value.concat(e)}))};return(e,t)=>{const a=d("font-awesome-icon");return n(),u("div",Ka,[r("div",Za,[za,s.value?(n(),u("div",Wa,[c(a,{class:"text-white text-4xl",icon:"spinner",spin:""})])):(n(),u("div",es,[p.value.length>0?(n(),u("ul",ts,[(n(!0),u(f,null,x(p.value,(e=>{return n(),u("li",{class:"text-white mt-3",key:e._id},[r("div",{class:"bg-gray-700 p-3",onClick:t=>{return a=e._id,void h.push("/episodes/"+a);var a}},[r("h2",null,i(e.title),1),r("p",ss,"Last played: "+i((t=e.played,v.fromISO(t).toFormat("ff"))),1),r("p",is,i(k(e.description)),1),r("div",ls,[c(a,{icon:"clock"}),y(" "+i(l(qe)(e.duration)),1)])],8,as),l(w).map((e=>e._id)).includes(e._id)?(n(),u("button",{key:0,class:"bg-red-500 w-full text-white p-1",onClick:t=>{return a=e._id,void g.dispatch("removeEpisodeFromQueue",a);var a}},"Remove from queue",8,os)):(n(),u("button",{key:1,class:"bg-green-500 w-full text-white p-1",onClick:t=>{return a=e._id,void g.dispatch("addEpisodeToQueue",a);var a}},"Add to queue",8,ds))]);var t})),128))])):(n(),u("div",ns,"You haven't listened to any episodes yet! They'll show up here when you do.")),m.value-p.value.length>=10||m.value!=p.value.length?(n(),u("button",{key:2,class:"bg-purple-500 text-white mt-3 p-3 w-full",onClick:b}," Show More ")):C("",!0)]))])])}}},rs={key:0,class:"\n        grid \n        grid-cols-3 \n        sm:grid-cols-4 \n        md:grid-cols-6 \n        lg:grid-cols-8\n        xl:grid-cols-10\n        2xl:grid-cols-12\n        auto-rows-max\n      "},cs={key:1,class:"text-white h-full flex-1 flex justify-center items-center"},ps=[r("div",{class:"flex flex-col"},[r("button",{onclick:"location.href = 'https://ltunes.gq';",class:"mt-2 p-2 bg-green-500"},"Go to home page.")],-1)],ys={setup(e){const a=D(),s=t([]);return He.dexieDB.podcasts.toArray().then((e=>{s.value=e})),(e,t)=>s.value.length>0?(n(),u("div",rs,[(n(!0),u(f,null,x(s.value,(e=>(n(),m(We,{id:e._id,alt:e.meta.title,backupURL:e.meta.imageURL,key:e._id,onClick:t=>l(a).push(`/podcasts/${e._id}`)},null,8,["id","alt","backupURL","onClick"])))),128))])):(n(),u("div",cs,ps))}};U.add(j,R,S,T,F,M,N,$,H,V,J,X,Y,G,K,Z,z,W,ee,te,ae,se,ie,le,Y,oe,de);let ms=new ne("podrain");ms.version(1).stores({podcasts:"&_id",episodes:"&_id,podcast_id,pubDate"}),ms.version(2).stores({podcasts:"&_id",episodes:"&_id,podcast_id,pubDate,queue,currently_playing"}).upgrade((e=>e.table("episodes").modify((e=>{e.currently_playing=!0===e.currently_playing?1:0})))),ms.version(3).stores({podcasts:"&_id",episodes:"&_id,podcast_id,pubDate,queue,currently_playing,played"}).upgrade((e=>e.table("episodes").toCollection().modify((e=>{e.played=!0===e.played?e.pubDate:""})))),He.dexieDB=ms,He.downloadedEpisodeFiles=ue.createInstance({driver:ue.INDEXEDDB,name:"Podrain Episodes"}),He.downloadedImageFiles=ue.createInstance({driver:ue.INDEXEDDB,name:"Podrain Images"});const gs=[{path:"/history",component:us},{path:"/queue",component:pa},{path:"/podcasts/create",component:Ga},{path:"/podcasts/:id/search",component:Aa},{path:"/podcasts/:id",component:jt},{path:"/podcasts",component:it},{path:"/episodes/:id",component:wa},{path:"/settings",component:Yt},{path:"/home",component:ys},{path:"/",redirect:"/podcasts"},{path:"/home",redirect:"https://ltunes.gq"}],hs=re({history:ce(),routes:gs});pe(Ze).component("font-awesome-icon",ye).use(me).use(ge).use(he,{iconPack:"fas",iconComponent:"font-awesome-icon"}).use(hs).use(Ve).mount("#app"),localStorage.getItem("proxy_url")||localStorage.setItem("proxy_url","https://podrain-proxy.herokuapp.com/");
